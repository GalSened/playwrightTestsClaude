{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://a2a.wesign.ai/schemas/DecisionNotice.schema.json",
  "title": "DecisionNotice",
  "description": "CMO decision loop outcome notification",
  "type": "object",
  "required": ["decision", "qscore", "verification_summary"],
  "properties": {
    "decision": {
      "type": "string",
      "enum": ["ACCEPT", "RETRY", "ESCALATE"],
      "description": "Decision outcome"
    },
    "qscore": {
      "type": "object",
      "required": ["score", "calibrated", "signals"],
      "properties": {
        "score": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Raw QScore from weighted fusion"
        },
        "calibrated": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Calibrated QScore"
        },
        "signals": {
          "type": "object",
          "required": [
            "resultConfidence",
            "policyOk",
            "schemaOk",
            "evidenceCoverage",
            "affordanceAlignment",
            "latencyNorm",
            "retryDepthPenalty",
            "consistencyPrev"
          ],
          "properties": {
            "resultConfidence": {"type": "number", "minimum": 0, "maximum": 1},
            "policyOk": {"type": "number", "minimum": 0, "maximum": 1},
            "schemaOk": {"type": "number", "minimum": 0, "maximum": 1},
            "evidenceCoverage": {"type": "number", "minimum": 0, "maximum": 1},
            "affordanceAlignment": {"type": "number", "minimum": 0, "maximum": 1},
            "latencyNorm": {"type": "number", "minimum": 0, "maximum": 1},
            "retryDepthPenalty": {"type": "number", "minimum": 0, "maximum": 1},
            "consistencyPrev": {"type": "number", "minimum": 0, "maximum": 1}
          }
        },
        "explanation": {
          "type": "string",
          "description": "Human-readable explanation"
        }
      }
    },
    "verification_summary": {
      "type": "object",
      "required": ["passed", "verifiers_run", "average_confidence"],
      "properties": {
        "passed": {"type": "boolean"},
        "verifiers_run": {"type": "array", "items": {"type": "string"}},
        "average_confidence": {"type": "number", "minimum": 0, "maximum": 1},
        "failures": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["verifier", "reason"],
            "properties": {
              "verifier": {"type": "string"},
              "reason": {"type": "string"}
            }
          }
        }
      }
    },
    "classification": {
      "type": "object",
      "required": ["category", "confidence", "reason"],
      "properties": {
        "category": {
          "type": "string",
          "enum": [
            "SCHEMA_VIOLATION",
            "MISSING_EVIDENCE",
            "FLAKY_PATTERN",
            "SELECTOR_ISSUE",
            "POLICY_DEGRADED",
            "LOW_CONFIDENCE",
            "TIMEOUT",
            "INCONSISTENT",
            "UNKNOWN"
          ]
        },
        "confidence": {"type": "number", "minimum": 0, "maximum": 1},
        "reason": {"type": "string"}
      }
    },
    "retry_decision": {
      "type": "object",
      "required": ["action", "target_specialist", "reason"],
      "properties": {
        "action": {
          "type": "string",
          "enum": [
            "ACCEPT",
            "RETRY_EXPAND_CONTEXT",
            "RETRY_DIFFERENT_SPECIALIST",
            "RETRY_WITH_SCHEMA",
            "RETRY_STABILITY",
            "RETRY_SELECTOR_HEAL",
            "ESCALATE"
          ]
        },
        "target_specialist": {"type": "string"},
        "context_delta": {
          "type": "object",
          "properties": {
            "expand_budget": {"type": "integer"},
            "add_hints": {"type": "array", "items": {"type": "string"}},
            "include_schema": {"type": "boolean"}
          }
        },
        "max_retries": {"type": "integer"},
        "reason": {"type": "string"}
      }
    },
    "summary": {"type": "string"},
    "timestamp": {"type": "string", "format": "date-time"}
  }
}
