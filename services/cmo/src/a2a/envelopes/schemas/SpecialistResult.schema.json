{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://qa-intelligence.com/schemas/a2a/SpecialistResult.schema.json",
  "title": "Specialist Result Envelope",
  "description": "Specialist execution result with proposal, confidence, and evidence",
  "type": "object",
  "required": ["meta", "payload"],
  "properties": {
    "meta": {
      "$ref": "EnvelopeMeta.schema.json",
      "description": "Envelope metadata with type=SpecialistResult"
    },
    "payload": {
      "type": "object",
      "required": ["task", "status", "confidence"],
      "properties": {
        "task": {
          "type": "string",
          "minLength": 1,
          "description": "Task identifier (must match SpecialistInvocationRequest.task)"
        },
        "status": {
          "type": "string",
          "enum": ["success", "failure", "timeout", "budget_exceeded", "cancelled"],
          "description": "Execution status"
        },
        "confidence": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Specialist's confidence in the result (0.0 to 1.0)"
        },
        "proposal": {
          "type": "object",
          "description": "Specialist's proposed solution/fix/output (structure varies by task)"
        },
        "rationale": {
          "type": "string",
          "minLength": 1,
          "maxLength": 4096,
          "description": "Human-readable explanation of the proposal"
        },
        "evidence": {
          "type": "object",
          "properties": {
            "references": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "type": {"type": "string", "enum": ["doc", "code", "test", "log", "url"]},
                  "location": {"type": "string"},
                  "snippet": {"type": "string"}
                }
              },
              "description": "Supporting references (docs, code snippets, logs, etc.)"
            },
            "reasoning_steps": {
              "type": "array",
              "items": {"type": "string"},
              "description": "Step-by-step reasoning trail"
            },
            "alternatives_considered": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "option": {"type": "string"},
                  "score": {"type": "number", "minimum": 0, "maximum": 1},
                  "reason_rejected": {"type": "string"}
                }
              },
              "description": "Alternative solutions that were considered and rejected"
            }
          },
          "description": "Evidence supporting the proposal"
        },
        "error": {
          "type": "object",
          "properties": {
            "code": {"type": "string"},
            "message": {"type": "string"},
            "details": {"type": "object"}
          },
          "required": ["code", "message"],
          "description": "Error information (present on failure/timeout/budget_exceeded)"
        },
        "metrics": {
          "type": "object",
          "properties": {
            "duration_ms": {"type": "integer", "minimum": 0},
            "tool_calls": {"type": "integer", "minimum": 0},
            "tokens_used": {"type": "integer", "minimum": 0},
            "cost_usd": {"type": "number", "minimum": 0}
          },
          "description": "Execution metrics"
        }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false
}
