# CMO/ELG Service Configuration

# Database - Postgres
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_DB=playwright_enterprise
POSTGRES_USER=admin
POSTGRES_PASSWORD=secure123
POSTGRES_SSL=false
POSTGRES_MAX_CONNECTIONS=20

# Redis Streams (A2A Transport)
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0
REDIS_STREAM_NAME=cmo:a2a
REDIS_CONSUMER_GROUP=cmo-workers
REDIS_CONSUMER_NAME=cmo-worker-1
REDIS_DLQ_STREAM=cmo:a2a:dlq

# S3-compatible storage (MinIO) - Artifacts
S3_ENDPOINT=http://localhost:9000
S3_REGION=us-east-1
S3_ACCESS_KEY_ID=minioadmin
S3_ACCESS_KEY_SECRET=minioadmin123
S3_BUCKET_NAME=cmo-artifacts
S3_FORCE_PATH_STYLE=true

# OpenTelemetry
OTEL_ENABLED=true
OTEL_SERVICE_NAME=cmo-elg
OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4318
OTEL_TRACE_SAMPLE_RATE=1.0

# OPA Policies
OPA_POLICY_PATH=./policies/default.wasm
OPA_ENABLED=true

# Logging
LOG_LEVEL=info
LOG_PRETTY=true

# Service
NODE_ENV=development
PORT=8083
HEALTH_CHECK_PATH=/health

# Runtime Configuration
ELG_MAX_STEP_DURATION_MS=30000
ELG_CHECKPOINT_INTERVAL=1
ELG_ACTIVITY_TIMEOUT_MS=60000
ELG_MAX_RETRIES=3

# ========================================
# H4R (Human-like Retrieval) Configuration
# ========================================

# Postgres FTS (always enabled)
H4R_POSTGRES_FTS_ENABLED=true
DATABASE_URL=postgresql://admin:secure123@localhost:5432/playwright_enterprise

# Qdrant Vector Search (optional)
H4R_QDRANT_URL=
QDRANT_API_KEY=

# Neo4j Graph Search (optional)
H4R_NEO4J_URL=
NEO4J_USERNAME=neo4j
NEO4J_PASSWORD=

# Candidate Generation
H4R_CANDIDATE_LIMIT=50

# Signal Weights (must sum to 1.0)
H4R_WEIGHT_RECENCY=0.25
H4R_WEIGHT_FREQUENCY=0.15
H4R_WEIGHT_IMPORTANCE=0.20
H4R_WEIGHT_CAUSALITY=0.15
H4R_WEIGHT_NOVELTY_INV=0.10
H4R_WEIGHT_TRUST=0.10
H4R_WEIGHT_SENSITIVITY_INV=0.05

# Recency Decay
H4R_RECENCY_DECAY_LAMBDA=0.1

# ========================================
# SCS (Specialist Context Slicer) Configuration
# ========================================

# Budget Limits
SCS_MAX_BYTES_DEFAULT=122880        # 120KB
SCS_MAX_TOKENS_DEFAULT=30000        # ~120KB / 4 chars per token
SCS_MAX_ITEMS_DEFAULT=100

# OPA Integration
SCS_OPA_URL=http://localhost:8181
SCS_OPA_POLICY_PATH=/v1/data/cmo/context
SCS_OPA_CACHE_TTL_MS=60000
SCS_OPA_FALLBACK_LOCAL=true

# ========================================
# Context Pack Configuration
# ========================================

# TL;DR Summary
CONTEXT_PACK_TLDR_SENTENCES=5

# Optional Features
CONTEXT_PACK_INCLUDE_GRAPH=false
CONTEXT_PACK_GENERATE_AFFORDANCES=true
